<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head.ejs')%>
<body>
    <%- include('../partials/nav.ejs')%>
   

<!--content-->
    <div class="container" style="margin-top: 40px;">
      <form id="formOne">
        <label for="title">Blog Title:</label>
        <input type="text" id="title" name="title" required>
        <label for="snippet">Blog Snippet:</label>
        <input type="text"  id="snippet" name="snippet" required>
        <label for="body">Blog body:</label>
        <textarea type="text" style="margin-top: 20px; height: 110px;" id="body" name="content" required></textarea>
        <div id="form" >
          <label>
            <input type="file" id="photo" name="photo">
            <span> Press the button to add an image to your blog: <br>
              <div class="btn-floating green">
                <i class="material-icons" style="color: #f2faf2;">add</i>
              </div> 
            </span>
          </label>
          <div class="output">
            <div class="valid"></div>
            <div class="error"></div>
          </div>
        </div>
        <button class="btn small green" style="margin-top: 30px;">Submit</button>
      </form>
    </div>
     <br/><br/><br><br>
    
  <!--  Scripts-->
  <script>

//firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
  import {getAuth, GoogleAuthProvider, signInWithPopup,signOut,onAuthStateChanged} from "https://www.gstatic.com/firebasejs/9.8.1/firebase-auth.js";
  import{storage} from "https://www.gstatic.com/firebasejs/9.8.1/firebase-storage.js";
  
  const firebaseConfig = {
  apiKey: "AIzaSyCoWoP6foxibGx-7tZQ8-QZUgJttyO32yo",
  authDomain: "movie-app-62211.firebaseapp.com",
  projectId: "movie-app-62211",
  storageBucket: "movie-app-62211.appspot.com",
  messagingSenderId: "175660892824",
  appId: "1:175660892824:web:5ad2e9fbdebb64a5fe46ed",
  measurementId: "G-GPKWP85ZGY"
};

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth=getAuth(app);
  const projectStorage=storage(app);
 


   const form=document.querySelector('#formOne');
   const photo=document.querySelector('#photo');
   const types=['image/png', 'image/jpeg']

   

   photo.addEventListener('change',(e)=>{
        let photoName=e.target.files[0];
          const li=document.querySelector('.error');
          const valid=document.querySelector('.valid');
          const error=`
          <p class="light red-text">Please select an image file(png or jpeg)<p>
          `
          const validFile= photoName.name;
        if(photoName && types.includes(photoName.type)){
          valid.innerHTML=validFile;
            li.innerHTML=''
        }else{
          li.innerHTML=error;
        }
    })
        
       form.addEventListener('submit',(e)=>{
          e.preventDefault();
          const blogTitle=form.title.value;
          const blogSnippet=form.snippet.value;
          const blogBody=form.content.value;
          let photoName=form.photo.files[0];
          const photoUrl=photoName.name;
          
          fetch('/blog',{
          method:'POST',
          headers:{
            'Content-type':'application/json'
          },
          body:JSON.stringify({
            title:blogTitle,
            snippet:blogSnippet,
            content:blogBody,
            blogImage:photoUrl
          })
        })
          //.then(response=>response.json())
          //.then(data=>console.log(data))
          //.catch(err=>console.log(err))
          .then(()=>{
            window.location.href='/'
          })
       })
  </script>
  <script src="./js/materialize.min.js"></script>
  <script src="./js/init.js" type="module"></script>
  </body>
</html>
